/*
A small script to test connection to Supabase and insert a test row into `submissions`.
Run with:
SUPABASE_KEY=<your-key> node scripts/test-supabase.js

Note: Do NOT commit secrets (SUPABASE_KEY) to this repo.
*/

const { createClient } = require('@supabase/supabase-js');

const SUPABASE_URL = process.env.SUPABASE_URL || 'https://fcilspmbkcwwfihxcgod.supabase.co';
const SUPABASE_KEY = process.env.SUPABASE_KEY;

if (!SUPABASE_KEY) {
  console.error('Please set SUPABASE_KEY (and optionally SUPABASE_URL) in environment variables.');
  process.exit(1);
}

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

async function run() {
  try {
    // Insert a test submission
    // Try inserting without 'receivedAt' field to avoid case-sensitivity issues across
    // PostgreSQL column names (the table might use 'receivedat' or 'received_at').
    const payload = {
      name: 'Test User',
      email: 'test@example.com',
      subject: 'Test insertion',
      message: 'This is a test generated by scripts/test-supabase.js'
    };

    const { data: insertData, error: insertError } = await supabase
      .from('submissions')
      .insert([payload])
      .select();

    if (insertError) {
      console.error('Insert failed:', insertError);
    } else {
      console.log('Insert succeeded:', insertData);
    }

    // Fetch latest 5 rows to verify
    // Use `id` to order since column casing may vary between installations
    const { data: rows, error: fetchError } = await supabase
      .from('submissions')
      .select('*')
      .order('id', { ascending: false })
      .limit(5);

    if (fetchError) {
      console.error('Fetch failed:', fetchError);
    } else {
      console.log('Latest submissions:', rows);
    }
  } catch (err) {
    console.error('Unexpected error:', err);
  }
}

run();
